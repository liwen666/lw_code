--Model表添加isSaveFormula

DECLARE columnCount NUMBER(9);
BEGIN
  SELECT COUNT(1) INTO columnCount FROM USER_TAB_COLUMNS WHERE COLUMN_NAME ='ISSAVEFORMULA' AND TABLE_NAME = 'P#DICT_T_MODEL';

  IF (columnCount = '0') THEN
    EXECUTE IMMEDIATE 'ALTER TABLE P#DICT_T_MODEL ADD ISSAVEFORMULA CHAR(1) default 0';
  END IF;
   
  EXECUTE IMMEDIATE Q'{CREATE OR REPLACE VIEW DICT_T_MODEL AS
SELECT
    TABLEID, APPID, DBTABLENAME,NAME, DBVERSION, DEALTYPE, EXTPROP, INPUTLVL, ISADD, ISMAN, ISPARTITION, ISRESERVED,
    ISSHOW, ISTASK, ISSUMTAB, MAINUPTAB, ORDERID, RELATAB, REMARK, SECUSQL, BGTLVL, INITSQL, INITSQLTIME,
    SHORTTITLE, STATUS, SUITID, TABLETYPE, TABSWHERE, ISBAK, INSERTVERSION, ISALLDISTRICT, isallyear,initsqlbtnname,isexcelimp,ISREADONLY, descfile, ISSAVEFORMULA
  FROM P#DICT_T_MODEL
  WHERE PROVINCE=GLOBAL_MULTYEAR_CZ.SECU_F_GLOBAL_PARM('DIVID') AND YEAR=GLOBAL_MULTYEAR_CZ.SECU_F_GLOBAL_PARM('YEAR') AND STATUS='1'}';
 
 SELECT COUNT(1) INTO columnCount FROM USER_TAB_COLUMNS WHERE COLUMN_NAME ='ISSAVEFORMULA' AND TABLE_NAME = 'P#DICT_T_MODEL_S';
  IF (columnCount = '0') THEN
    EXECUTE IMMEDIATE 'ALTER TABLE P#DICT_T_MODEL_S ADD ISSAVEFORMULA CHAR(1)  default 0';
  END IF;


  EXECUTE IMMEDIATE Q'{CREATE OR REPLACE VIEW DICT_T_MODEL_S AS
SELECT
    APPID, BGTLVL, DBTABLENAME, DBVERSION, DEALTYPE, EXTPROP, INPUTLVL, ISADD, ISMAN, ISPARTITION, ISRESERVED,
    ISSHOW, ISTASK, ISSUMTAB, MAINUPTAB, NAME, ORDERID, RELATAB, REMARK, SECUSQL, INITSQL, INITSQLTIME,
    SHORTTITLE, STATUS, SUITID, TABLEID, TABLETYPE, TABSWHERE, ISBAK, INSERTVERSION, ISALLDISTRICT,
  isallyear,initsqlbtnname,isexcelimp,ISREADONLY, descfile, ISSAVEFORMULA
  FROM P#DICT_T_MODEL_S
  WHERE PROVINCE=GLOBAL_MULTYEAR_CZ.SECU_F_GLOBAL_PARM('DIVID') AND YEAR=GLOBAL_MULTYEAR_CZ.SECU_F_GLOBAL_PARM('YEAR') AND STATUS='1'}';
END;
--13-dict_t_model添加保存数据时是否刷新公式字段isSaveFormula
