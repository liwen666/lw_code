DECLARE
      V_CNT NUMBER;
BEGIN
  
  --判断表字段是否存在
  SELECT COUNT(1) INTO V_CNT FROM User_Tab_Cols b WHERE b.TABLE_NAME ='P#SPF_T_PINVESTPLAN' AND COLUMN_NAME ='APPLYNUM';
  IF v_CNT = 0 THEN
    EXECUTE IMMEDIATE 'ALTER TABLE P#SPF_T_PINVESTPLAN  ADD (APPLYNUM NUMBER(24,6))' ;
  END IF; 
    SELECT COUNT(1) INTO V_CNT FROM User_Tab_Cols b WHERE b.TABLE_NAME ='P#SPF_T_PINVESTPLAN_BAK' AND COLUMN_NAME ='APPLYNUM';
  IF v_CNT = 0 THEN
    EXECUTE IMMEDIATE 'ALTER TABLE P#SPF_T_PINVESTPLAN_BAK  ADD (APPLYNUM NUMBER(24,6))' ;
  END IF; 
  --新增APPLYNUMfactor
  FOR TAB IN (SELECT a.DISTRICTID CODE  FROM pub_t_partition_divid a WHERE a.year <> '*') LOOP
     SELECT COUNT(1) INTO V_CNT FROM dict_t_factor WHERE columnid ='14C0C3214F33189EE050A8C0210507CA';
     IF   V_CNT = 0 THEN
      DELETE FROM dict_t_factor WHERE dbcolumnname ='APPLYNUM' AND tableid ='14C0C3214F27189EE050A8C0210507CA';
     insert into P#DICT_T_FACTOR (YEAR, PROVINCE, ALIAS, BANDCOLUMNID, BANDREFDWCOL, BGTLVL, COLFORMAT, COLTIPS, COLUMNID, CSID, DATALENGTH, DATATYPE, DBCOLUMNNAME, DEFAULTVALUE, DEID, EXTPROP, FRMCOLID, FRMTABID, HREFLOC, HREFPARMID, ISBANDCOL, ISHREF, OPENWINDOWTYPE, ISKEY, ISLEAF, ISREGEX, ISRESERVE, ISSUM, ISUPDATE, ISVIRTUAL, ISVISIBLE, LEVELNO, NAME, NULLABLE, ORDERID, REGEXPR, REGEXPRINFO, SCALE, SHOWFORMAT, SHOWWIDTH, STATUS, SUPERID, TABLEID, VIRCONTEXT, PARENTNODECANCHECK)
     values ('2016', TAB.CODE, null, null, null, null, null, null, '14C0C3214F33189EE050A8C0210507CA', null, 24, 2, 'APPLYNUM', '0', null, '0000000000000000000000000000000', null, null, null, null, '0', '0', '1', '0', '1', '0', '0', '1', '1', '0', '1', 2, '申请财政资金(万元)', '1', 37, null, null, 6, null, 155, '1', '14C0FCA3BD6EC7E2E050A8C0210509CB', '14C0C3214F27189EE050A8C0210507CA', null, '0');
    END IF;
  END LOOP;
     sys_p_recreate_views('14C0C3214F27189EE050A8C0210507CA');
END;
--新增申请财政资金APPLYNUM
