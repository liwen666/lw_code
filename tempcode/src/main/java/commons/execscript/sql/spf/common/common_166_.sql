declare
v_name varchar2(64);
v_type varchar2(64);
V_RET  varchar2(4000);
begin

--1、创建纳入指标日志表
v_name := 'SPF_T_DATAACCOUNTLOG';
-- Drop table
  SELECT nvl((SELECT object_type FROM user_objects WHERE object_name = v_name),'') INTO v_type FROM dual;
  IF v_type = 'TABLE' THEN
    EXECUTE IMMEDIATE 'DROP TABLE '|| v_name;
  END IF;
   IF v_type = 'VIEW' THEN
    EXECUTE IMMEDIATE 'DROP VIEW '|| v_name;
    EXECUTE IMMEDIATE 'DROP TABLE P#'|| v_name;
  END IF;

execute immediate Q'{create table P#SPF_T_DATAACCOUNTLOG
(
  guid      VARCHAR2(32) default SYS_GUID() not null,
  ruleid    VARCHAR2(32),
  objid     VARCHAR2(32),
  runtime   TIMESTAMP(6),
  year      CHAR(4) not null,
  province  VARCHAR2(9) not null,
  dbversion TIMESTAMP(6) default SYSDATE,
  status    CHAR(1) default 1 not null
)}';

execute immediate 'alter table P#SPF_T_DATAACCOUNTLOG add constraint PK_SPF_T_DATAACCOUNTLOG primary key (PROVINCE, YEAR, STATUS, GUID)';
sys_p_partition_table('P#SPF_T_DATAACCOUNTLOG');


--2、创建存储过程-生成纳入指标生成来源表存储过程
execute immediate Q'[CREATE OR REPLACE PROCEDURE P_SPF_TRANSPOSE_ININDEX(P_SRC_TABLEID VARCHAR2,P_BILLDEFID VARCHAR2,P_TABLEID VARCHAR2) IS
    V_TABLE VARCHAR2(3000);
    V_SQL VARCHAR2(32760);
    V_VIEW_NAME VARCHAR2(30);
    V_CNNAME VARCHAR2(200);
    V_CNT NUMBER;
    V_EXISTS NUMBER;
    V_DEALTYPE VARCHAR2(16);
  BEGIN

    --源表转置表
    --P_TABLEID源表转置ID
    SELECT DBTABLENAME,NAME,DEALTYPE INTO V_TABLE,V_CNNAME ,V_DEALTYPE FROM DICT_T_MODEL WHERE TABLEID = P_SRC_TABLEID;
    V_VIEW_NAME := V_TABLE||'_TP';
    V_CNNAME := V_CNNAME||'(记账转置)';



    IF V_DEALTYPE<>'5*02' THEN
       raise_application_error(-20001,'来源表dealtype不是项目资金计划表.tableid:'||P_SRC_TABLEID);
       return ;
    END IF;

    SELECT COUNT(*) INTO V_EXISTS FROM DICT_T_MODEL WHERE TABLEID = P_TABLEID;
    IF V_EXISTS=0 THEN
       delete from  DICT_T_FACTOR where tableid in (select tableid from DICT_T_MODEL where DBTABLENAME=V_VIEW_NAME);
       delete from  DICT_T_MODEL where DBTABLENAME=V_VIEW_NAME;
    END IF;

    --生成DICT_T_MODEL
    INSERT INTO DICT_T_MODEL(APPID, BGTLVL, DBTABLENAME, DEALTYPE, EXTPROP, INPUTLVL, ISADD, ISMAN, ISPARTITION, ISRESERVED, ISSHOW, ISTASK, ISSUMTAB, MAINUPTAB, NAME, ORDERID, RELATAB, REMARK, SECUSQL, INITSQLTIME, SHORTTITLE, SUITID, TABLEID, TABLETYPE,ISBAK,ISALLDISTRICT)
      SELECT APPID, BGTLVL,V_VIEW_NAME DBTABLENAME,'', RPAD('0',100,'0') EXTPROP, INPUTLVL, ISADD, ISMAN, ISPARTITION,'0' ISRESERVED,'1' ISSHOW,'0' ISTASK, ISSUMTAB, MAINUPTAB, V_CNNAME NAME, ORDERID, RELATAB, REMARK, SECUSQL,'1' INITSQLTIME, SHORTTITLE, SUITID, P_TABLEID TABLEID, '2' TABLETYPE,'0' ISBAK,ISALLDISTRICT
      FROM DICT_T_MODEL
      WHERE TABLEID = P_SRC_TABLEID AND
            NOT EXISTS(SELECT 1 FROM DICT_T_MODEL WHERE  TABLEID=P_TABLEID );

    --生成DICT_T_FACTOR
    INSERT INTO DICT_T_FACTOR (ALIAS, BANDCOLUMNID, BANDREFDWCOL, BGTLVL, COLFORMAT, COLTIPS, COLUMNID, CSID, DATALENGTH, DATATYPE, DBCOLUMNNAME,  DEFAULTVALUE, DEID, EXTPROP, FRMCOLID, FRMTABID, HREFLOC, HREFPARMID, ISBANDCOL, ISHREF, OPENWINDOWTYPE, ISKEY, ISLEAF, ISREGEX, ISRESERVE, ISSUM, ISUPDATE, ISVIRTUAL, ISVISIBLE, LEVELNO, NAME, NULLABLE, ORDERID, REGEXPR, REGEXPRINFO, SCALE, SHOWFORMAT, SHOWWIDTH, STATUS, SUPERID, TABLEID, VIRCONTEXT,  PARENTNODECANCHECK, XLSXCOLUMNID)
      SELECT '项目ID', NULL, NULL, NULL, NULL, NULL, RAWTOHEX(SYS_GUID()), NULL, 32, 3, 'PROJECTID',  NULL, NULL, '0000000000000000000000000000000', NULL, NULL, NULL, NULL, '0', '0', '0', '0', '1', '0', '0', '0', '0', '0', '1', 1, '项目ID', '1', V_CNT + 1, NULL, NULL, 0, '0', NULL, '1', '0', P_TABLEID, NULL,  '0', NULL FROM DUAL
      WHERE NOT EXISTS(SELECT 1 FROM DICT_T_FACTOR  WHERE TABLEID=P_TABLEID AND DBCOLUMNNAME='PROJECTID' );

    INSERT INTO DICT_T_FACTOR (ALIAS, BANDCOLUMNID, BANDREFDWCOL, BGTLVL, COLFORMAT, COLTIPS, COLUMNID, CSID, DATALENGTH, DATATYPE, DBCOLUMNNAME,  DEFAULTVALUE, DEID, EXTPROP, FRMCOLID, FRMTABID, HREFLOC, HREFPARMID, ISBANDCOL, ISHREF, OPENWINDOWTYPE, ISKEY, ISLEAF, ISREGEX, ISRESERVE, ISSUM, ISUPDATE, ISVIRTUAL, ISVISIBLE, LEVELNO, NAME, NULLABLE, ORDERID, REGEXPR, REGEXPRINFO, SCALE, SHOWFORMAT, SHOWWIDTH, STATUS, SUPERID, TABLEID, VIRCONTEXT,  PARENTNODECANCHECK, XLSXCOLUMNID)
      SELECT '经济科目', NULL, NULL, NULL, NULL, NULL, RAWTOHEX(SYS_GUID()), NULL, 32, 3, 'EXPECOID',  NULL, NULL, '0000000000000000000000000000000', NULL, NULL, NULL, NULL, '0', '0', '0', '0', '1', '0', '0', '0', '0', '0', '1', 1, '经济科目', '1', V_CNT + 1, NULL, NULL, 0, '0', NULL, '1', '0', P_TABLEID, NULL,  '0', NULL FROM DUAL
      WHERE NOT EXISTS(SELECT 1 FROM DICT_T_FACTOR  WHERE TABLEID=P_TABLEID AND DBCOLUMNNAME='EXPECOID' );

    INSERT INTO DICT_T_FACTOR (ALIAS, BANDCOLUMNID, BANDREFDWCOL, BGTLVL, COLFORMAT, COLTIPS, COLUMNID, CSID, DATALENGTH, DATATYPE, DBCOLUMNNAME,  DEFAULTVALUE, DEID, EXTPROP, FRMCOLID, FRMTABID, HREFLOC, HREFPARMID, ISBANDCOL, ISHREF, OPENWINDOWTYPE, ISKEY, ISLEAF, ISREGEX, ISRESERVE, ISSUM, ISUPDATE, ISVIRTUAL, ISVISIBLE, LEVELNO, NAME, NULLABLE, ORDERID, REGEXPR, REGEXPRINFO, SCALE, SHOWFORMAT, SHOWWIDTH, STATUS, SUPERID, TABLEID, VIRCONTEXT,  PARENTNODECANCHECK, XLSXCOLUMNID)
      SELECT '年份', NULL, NULL, NULL, NULL, NULL, RAWTOHEX(SYS_GUID()), NULL, 32, 3, 'FINYEAR',  NULL, NULL, '0000000000000000000000000000000', NULL, NULL, NULL, NULL, '0', '0', '0', '0', '1', '0', '0', '0', '0', '0', '1', 1, '年份', '1', V_CNT + 1, NULL, NULL, 0, '0', NULL, '1', '0', P_TABLEID, NULL,  '0', NULL FROM DUAL
      WHERE NOT EXISTS(SELECT 1 FROM DICT_T_FACTOR  WHERE TABLEID=P_TABLEID AND DBCOLUMNNAME='FINYEAR' );

    INSERT INTO DICT_T_FACTOR (ALIAS, BANDCOLUMNID, BANDREFDWCOL, BGTLVL, COLFORMAT, COLTIPS, COLUMNID, CSID, DATALENGTH, DATATYPE, DBCOLUMNNAME,  DEFAULTVALUE, DEID, EXTPROP, FRMCOLID, FRMTABID, HREFLOC, HREFPARMID, ISBANDCOL, ISHREF, OPENWINDOWTYPE, ISKEY, ISLEAF, ISREGEX, ISRESERVE, ISSUM, ISUPDATE, ISVIRTUAL, ISVISIBLE, LEVELNO, NAME, NULLABLE, ORDERID, REGEXPR, REGEXPRINFO, SCALE, SHOWFORMAT, SHOWWIDTH, STATUS, SUPERID, TABLEID, VIRCONTEXT,  PARENTNODECANCHECK, XLSXCOLUMNID)
      SELECT '区划ID', NULL, NULL, NULL, NULL, NULL, RAWTOHEX(SYS_GUID()), NULL, 32, 3, 'DISTRICTID',  NULL, NULL, '0000000000000000000000000000000', NULL, NULL, NULL, NULL, '0', '0', '0', '0', '1', '0', '0', '0', '0', '0', '1', 1, '区划ID', '1', V_CNT + 1, NULL, NULL, 0, '0', NULL, '1', '0', P_TABLEID, NULL,  '0', NULL FROM DUAL
      WHERE NOT EXISTS(SELECT 1 FROM DICT_T_FACTOR  WHERE TABLEID=P_TABLEID AND DBCOLUMNNAME='DISTRICTID' );


    INSERT INTO DICT_T_FACTOR (ALIAS, BANDCOLUMNID, BANDREFDWCOL, BGTLVL, COLFORMAT, COLTIPS, COLUMNID, CSID, DATALENGTH, DATATYPE, DBCOLUMNNAME,  DEFAULTVALUE, DEID, EXTPROP, FRMCOLID, FRMTABID, HREFLOC, HREFPARMID, ISBANDCOL, ISHREF, OPENWINDOWTYPE, ISKEY, ISLEAF, ISREGEX, ISRESERVE, ISSUM, ISUPDATE, ISVIRTUAL, ISVISIBLE, LEVELNO, NAME, NULLABLE, ORDERID, REGEXPR, REGEXPRINFO, SCALE, SHOWFORMAT, SHOWWIDTH, STATUS, SUPERID, TABLEID, VIRCONTEXT,  PARENTNODECANCHECK, XLSXCOLUMNID)
      SELECT '处理类型', NULL, NULL, NULL, NULL, NULL, RAWTOHEX(SYS_GUID()), NULL, 32, 3, 'DEALTYPE',  NULL, NULL, '0000000000000000000000000000000', NULL, NULL, NULL, NULL, '0', '0', '0', '0', '1', '0', '0', '0', '0', '0', '1', 1, '处理类型', '1', V_CNT + 1, NULL, NULL, 0, '0', NULL, '1', '0', P_TABLEID, NULL,  '0', NULL FROM DUAL
      WHERE NOT EXISTS(SELECT 1 FROM DICT_T_FACTOR  WHERE TABLEID=P_TABLEID AND DBCOLUMNNAME='DEALTYPE' );

    INSERT INTO DICT_T_FACTOR (ALIAS, BANDCOLUMNID, BANDREFDWCOL, BGTLVL, COLFORMAT, COLTIPS, COLUMNID, CSID, DATALENGTH, DATATYPE, DBCOLUMNNAME,  DEFAULTVALUE, DEID, EXTPROP, FRMCOLID, FRMTABID, HREFLOC, HREFPARMID, ISBANDCOL, ISHREF, OPENWINDOWTYPE, ISKEY, ISLEAF, ISREGEX, ISRESERVE, ISSUM, ISUPDATE, ISVIRTUAL, ISVISIBLE, LEVELNO, NAME, NULLABLE, ORDERID, REGEXPR, REGEXPRINFO, SCALE, SHOWFORMAT, SHOWWIDTH, STATUS, SUPERID, TABLEID, VIRCONTEXT,  PARENTNODECANCHECK, XLSXCOLUMNID)
      SELECT '项目名称', NULL, NULL, NULL, NULL, NULL, RAWTOHEX(SYS_GUID()), NULL, 32, 3, 'PROJNAME',  NULL, NULL, '0000000000000000000000000000000', NULL, NULL, NULL, NULL, '0', '0', '0', '0', '1', '0', '0', '0', '0', '0', '1', 1, '项目名称', '1', V_CNT + 1, NULL, NULL, 0, '0', NULL, '1', '0', P_TABLEID, NULL,  '0', NULL FROM DUAL
      WHERE NOT EXISTS(SELECT 1 FROM DICT_T_FACTOR  WHERE TABLEID=P_TABLEID AND DBCOLUMNNAME='PROJNAME' );

    INSERT INTO DICT_T_FACTOR (ALIAS, BANDCOLUMNID, BANDREFDWCOL, BGTLVL, COLFORMAT, COLTIPS, COLUMNID, CSID, DATALENGTH, DATATYPE, DBCOLUMNNAME,  DEFAULTVALUE, DEID, EXTPROP, FRMCOLID, FRMTABID, HREFLOC, HREFPARMID, ISBANDCOL, ISHREF, OPENWINDOWTYPE, ISKEY, ISLEAF, ISREGEX, ISRESERVE, ISSUM, ISUPDATE, ISVIRTUAL, ISVISIBLE, LEVELNO, NAME, NULLABLE, ORDERID, REGEXPR, REGEXPRINFO, SCALE, SHOWFORMAT, SHOWWIDTH, STATUS, SUPERID, TABLEID, VIRCONTEXT,  PARENTNODECANCHECK, XLSXCOLUMNID)
      SELECT '项目编码', NULL, NULL, NULL, NULL, NULL, RAWTOHEX(SYS_GUID()), NULL, 32, 3, 'PROJCODE',  NULL, NULL, '0000000000000000000000000000000', NULL, NULL, NULL, NULL, '0', '0', '0', '0', '1', '0', '0', '0', '0', '0', '1', 1, '项目编码', '1', V_CNT + 1, NULL, NULL, 0, '0', NULL, '1', '0', P_TABLEID, NULL,  '0', NULL FROM DUAL
      WHERE NOT EXISTS(SELECT 1 FROM DICT_T_FACTOR  WHERE TABLEID=P_TABLEID AND DBCOLUMNNAME='PROJCODE' );

    INSERT INTO DICT_T_FACTOR (ALIAS, BANDCOLUMNID, BANDREFDWCOL, BGTLVL, COLFORMAT, COLTIPS, COLUMNID, CSID, DATALENGTH, DATATYPE, DBCOLUMNNAME,  DEFAULTVALUE, DEID, EXTPROP, FRMCOLID, FRMTABID, HREFLOC, HREFPARMID, ISBANDCOL, ISHREF, OPENWINDOWTYPE, ISKEY, ISLEAF, ISREGEX, ISRESERVE, ISSUM, ISUPDATE, ISVIRTUAL, ISVISIBLE, LEVELNO, NAME, NULLABLE, ORDERID, REGEXPR, REGEXPRINFO, SCALE, SHOWFORMAT, SHOWWIDTH, STATUS, SUPERID, TABLEID, VIRCONTEXT,  PARENTNODECANCHECK, XLSXCOLUMNID)
      SELECT '单位ID', NULL, NULL, NULL, NULL, NULL, RAWTOHEX(SYS_GUID()), NULL, 32, 3, 'AGENCYID',  NULL, NULL, '0000000000000000000000000000000', NULL, NULL, NULL, NULL, '0', '0', '0', '0', '1', '0', '0', '0', '0', '0', '1', 1, '单位ID', '1', V_CNT + 1, NULL, NULL, 0, '0', NULL, '1', '0', P_TABLEID, NULL,  '0', NULL FROM DUAL
      WHERE NOT EXISTS(SELECT 1 FROM DICT_T_FACTOR  WHERE TABLEID=P_TABLEID AND DBCOLUMNNAME='AGENCYID' );

    INSERT INTO DICT_T_FACTOR (ALIAS, BANDCOLUMNID, BANDREFDWCOL, BGTLVL, COLFORMAT, COLTIPS, COLUMNID, CSID, DATALENGTH, DATATYPE, DBCOLUMNNAME,  DEFAULTVALUE, DEID, EXTPROP, FRMCOLID, FRMTABID, HREFLOC, HREFPARMID, ISBANDCOL, ISHREF, OPENWINDOWTYPE, ISKEY, ISLEAF, ISREGEX, ISRESERVE, ISSUM, ISUPDATE, ISVIRTUAL, ISVISIBLE, LEVELNO, NAME, NULLABLE, ORDERID, REGEXPR, REGEXPRINFO, SCALE, SHOWFORMAT, SHOWWIDTH, STATUS, SUPERID, TABLEID, VIRCONTEXT,  PARENTNODECANCHECK, XLSXCOLUMNID)
      SELECT '功能科目', NULL, NULL, NULL, NULL, NULL, RAWTOHEX(SYS_GUID()), NULL, 32, 3, 'EXPFUNCID',  NULL, NULL, '0000000000000000000000000000000', NULL, NULL, NULL, NULL, '0', '0', '0', '0', '1', '0', '0', '0', '0', '0', '1', 1, '功能科目', '1', V_CNT + 1, NULL, NULL, 0, '0', NULL, '1', '0', P_TABLEID, NULL,  '0', NULL FROM DUAL
      WHERE NOT EXISTS(SELECT 1 FROM DICT_T_FACTOR  WHERE TABLEID=P_TABLEID AND DBCOLUMNNAME='EXPFUNCID' );

    INSERT INTO DICT_T_FACTOR (ALIAS, BANDCOLUMNID, BANDREFDWCOL, BGTLVL, COLFORMAT, COLTIPS, COLUMNID, CSID, DATALENGTH, DATATYPE, DBCOLUMNNAME,  DEFAULTVALUE, DEID, EXTPROP, FRMCOLID, FRMTABID, HREFLOC, HREFPARMID, ISBANDCOL, ISHREF, OPENWINDOWTYPE, ISKEY, ISLEAF, ISREGEX, ISRESERVE, ISSUM, ISUPDATE, ISVIRTUAL, ISVISIBLE, LEVELNO, NAME, NULLABLE, ORDERID, REGEXPR, REGEXPRINFO, SCALE, SHOWFORMAT, SHOWWIDTH, STATUS, SUPERID, TABLEID, VIRCONTEXT,  PARENTNODECANCHECK, XLSXCOLUMNID)
      SELECT 'SPFID', NULL, NULL, NULL, NULL, NULL, RAWTOHEX(SYS_GUID()), NULL, 32, 3, 'SPFID',  NULL, NULL, '0000000000000000000000000000000', NULL, NULL, NULL, NULL, '0', '0', '0', '0', '1', '0', '0', '0', '0', '0', '1', 1, 'SPFID', '1', V_CNT + 1, NULL, NULL, 0, '0', NULL, '1', '0', P_TABLEID, NULL,  '0', NULL FROM DUAL
      WHERE NOT EXISTS(SELECT 1 FROM DICT_T_FACTOR  WHERE TABLEID=P_TABLEID AND DBCOLUMNNAME='SPFID' );

    INSERT INTO DICT_T_FACTOR (ALIAS, BANDCOLUMNID, BANDREFDWCOL, BGTLVL, COLFORMAT, COLTIPS, COLUMNID, CSID, DATALENGTH, DATATYPE, DBCOLUMNNAME,  DEFAULTVALUE, DEID, EXTPROP, FRMCOLID, FRMTABID, HREFLOC, HREFPARMID, ISBANDCOL, ISHREF, OPENWINDOWTYPE, ISKEY, ISLEAF, ISREGEX, ISRESERVE, ISSUM, ISUPDATE, ISVIRTUAL, ISVISIBLE, LEVELNO, NAME, NULLABLE, ORDERID, REGEXPR, REGEXPRINFO, SCALE, SHOWFORMAT, SHOWWIDTH, STATUS, SUPERID, TABLEID, VIRCONTEXT,  PARENTNODECANCHECK, XLSXCOLUMNID)
      SELECT '部门ID', NULL, NULL, NULL, NULL, NULL, RAWTOHEX(SYS_GUID()), NULL, 32, 3, 'DEPTID',  NULL, NULL, '0000000000000000000000000000000', NULL, NULL, NULL, NULL, '0', '0', '0', '0', '1', '0', '0', '0', '0', '0', '1', 1, '部门ID', '1', V_CNT + 1, NULL, NULL, 0, '0', NULL, '1', '0', P_TABLEID, NULL,  '0', NULL FROM DUAL
      WHERE NOT EXISTS(SELECT 1 FROM DICT_T_FACTOR  WHERE TABLEID=P_TABLEID AND DBCOLUMNNAME='DEPTID' );

    INSERT INTO DICT_T_FACTOR (ALIAS, BANDCOLUMNID, BANDREFDWCOL, BGTLVL, COLFORMAT, COLTIPS, COLUMNID, CSID, DATALENGTH, DATATYPE, DBCOLUMNNAME,  DEFAULTVALUE, DEID, EXTPROP, FRMCOLID, FRMTABID, HREFLOC, HREFPARMID, ISBANDCOL, ISHREF, OPENWINDOWTYPE, ISKEY, ISLEAF, ISREGEX, ISRESERVE, ISSUM, ISUPDATE, ISVIRTUAL, ISVISIBLE, LEVELNO, NAME, NULLABLE, ORDERID, REGEXPR, REGEXPRINFO, SCALE, SHOWFORMAT, SHOWWIDTH, STATUS, SUPERID, TABLEID, VIRCONTEXT,  PARENTNODECANCHECK, XLSXCOLUMNID)
      SELECT '项目类别', NULL, NULL, NULL, NULL, NULL, RAWTOHEX(SYS_GUID()), NULL, 32, 3, 'PROJTYPE',  NULL, NULL, '0000000000000000000000000000000', NULL, NULL, NULL, NULL, '0', '0', '0', '0', '1', '0', '0', '0', '0', '0', '1', 1, '项目类别', '1', V_CNT + 1, NULL, NULL, 0, '0', NULL, '1', '0', P_TABLEID, NULL,  '0', NULL FROM DUAL
      WHERE NOT EXISTS(SELECT 1 FROM DICT_T_FACTOR  WHERE TABLEID=P_TABLEID AND DBCOLUMNNAME='PROJTYPE' );

    INSERT INTO DICT_T_FACTOR (ALIAS, BANDCOLUMNID, BANDREFDWCOL, BGTLVL, COLFORMAT, COLTIPS, COLUMNID, CSID, DATALENGTH, DATATYPE, DBCOLUMNNAME,  DEFAULTVALUE, DEID, EXTPROP, FRMCOLID, FRMTABID, HREFLOC, HREFPARMID, ISBANDCOL, ISHREF, OPENWINDOWTYPE, ISKEY, ISLEAF, ISREGEX, ISRESERVE, ISSUM, ISUPDATE, ISVIRTUAL, ISVISIBLE, LEVELNO, NAME, NULLABLE, ORDERID, REGEXPR, REGEXPRINFO, SCALE, SHOWFORMAT, SHOWWIDTH, STATUS, SUPERID, TABLEID, VIRCONTEXT,  PARENTNODECANCHECK, XLSXCOLUMNID)
      SELECT '金额', NULL, NULL, NULL, NULL, NULL, RAWTOHEX(SYS_GUID()), NULL, 24, 2, 'AMOUNT',  NULL, NULL, '0000000000000000000000000000000', NULL, NULL, NULL, NULL, '0', '0', '0', '0', '1', '0', '0', '0', '0', '0', '1', 1, '金额', '1', V_CNT + 2, NULL, NULL, 6, '0', NULL, '1', '0', P_TABLEID, NULL,  '0', NULL FROM DUAL
      WHERE NOT EXISTS(SELECT 1 FROM DICT_T_FACTOR  WHERE TABLEID=P_TABLEID AND DBCOLUMNNAME='AMOUNT' );

    INSERT INTO DICT_T_FACTOR (ALIAS, BANDCOLUMNID, BANDREFDWCOL, BGTLVL, COLFORMAT, COLTIPS, COLUMNID, CSID, DATALENGTH, DATATYPE, DBCOLUMNNAME,  DEFAULTVALUE, DEID, EXTPROP, FRMCOLID, FRMTABID, HREFLOC, HREFPARMID, ISBANDCOL, ISHREF, OPENWINDOWTYPE, ISKEY, ISLEAF, ISREGEX, ISRESERVE, ISSUM, ISUPDATE, ISVIRTUAL, ISVISIBLE, LEVELNO, NAME, NULLABLE, ORDERID, REGEXPR, REGEXPRINFO, SCALE, SHOWFORMAT, SHOWWIDTH, STATUS, SUPERID, TABLEID, VIRCONTEXT,  PARENTNODECANCHECK, XLSXCOLUMNID)
      SELECT '数据类型', NULL, NULL, NULL, NULL, NULL, RAWTOHEX(SYS_GUID()), NULL, 32, 3, 'DATATYPE',  NULL, NULL, '0000000000000000000000000000000', NULL, NULL, NULL, NULL, '0', '0', '0', '0', '1', '0', '0', '0', '0', '0', '1', 1, '数据类型', '1', V_CNT + 1, NULL, NULL, 0, '0', NULL, '1', '0', P_TABLEID, NULL,  '0', NULL FROM DUAL
      WHERE NOT EXISTS(SELECT 1 FROM DICT_T_FACTOR  WHERE TABLEID=P_TABLEID AND DBCOLUMNNAME='DATATYPE' );


    V_SQL :=  'CREATE OR REPLACE VIEW '||V_VIEW_NAME||' AS '||Q'{
   
    select * from (
        select i.PROJECTID,
               i.EXPECOID,
               i.FINYEAR,
               i.ADDINDEXNUM AMOUNT,
               p.PROJNAME,
               p.PROJCODE,
               
               (case when 
                      a.DISTRICTID=f.DISTRICTID  and a.divtype='0'  then p.AGENCYID
                    when
                      a.DISTRICTID=f.DISTRICTID  and (a.divtype = '3' or a.divtype = '4')  then f.FIRAGENCYID
                    when 
                      a.DISTRICTID<>f.DISTRICTID then a.DISTRICTID
                end) AGENCYID,  
                                  
                (case when 
                      a.DISTRICTID=f.DISTRICTID  and a.divtype='0' then '1'
                    when
                      a.DISTRICTID=f.DISTRICTID  and (a.divtype = '3' or a.divtype = '4') then '2'
                    when 
                      a.DISTRICTID<>f.DISTRICTID then '3'
                end) DEALTYPE, 
                                               
               p.ISINDEX,
               f.DISTRICTID,
               i.EXPFUNCID,
               f.SPFID,
               f.DEPTID,
               pt.PROJTYPE,
               i.STATUS,
               i.DBVERSION,
               i.datakey
                        
          from p#Spf_t_Pinvestplan i,
               spf_t_pbaseinfo   p,
               spf_t_fbaseinfo   f,
               SPF_T_PROJECTTYPE pt,
               code_t_agency_spf a
         where i.ISPLANVALID = '1'
           and i.PROJECTID = p.PROJECTID
           and p.SPFID = f.SPFID
           and f.PROJTYPEID = pt.PROJTYPEID
           and p.ISINDEX='1'
           and p.AGENCYID=a.GUID )

 }';
 /*
   dbms_output.put_line(v_sql);
 */
    
    EXECUTE IMMEDIATE V_SQL;

exception
  when others then
     rollback;
     raise_application_error(-20001,'执行存储过程失败,原因是:'||sqlerrm);
END P_SPF_TRANSPOSE_ININDEX;
]';

--3、生成目标视图及其model信息
--(1)创建视图
execute immediate Q'{create or replace view spf_t_pinvestplan_tp as
select PROJECTID,EXPECOID,FINYEAR,AMOUNT,PROJNAME,PROJCODE,AGENCYID,DEALTYPE,ISINDEX,DISTRICTID,EXPFUNCID,SPFID,DEPTID,PROJTYPE,STATUS,DBVERSION,DATAKEY from (
        select i.PROJECTID,
               i.EXPECOID,
               i.FINYEAR,
               i.ADDINDEXNUM AMOUNT,
               p.PROJNAME,
               p.PROJCODE,
               
               (case when 
                      a.DISTRICTID=f.DISTRICTID  and a.divtype='0'  then p.AGENCYID
                    when
                      a.DISTRICTID=f.DISTRICTID  and (a.divtype = '3' or a.divtype = '4')  then f.FIRAGENCYID
                    when 
                      a.DISTRICTID<>f.DISTRICTID then a.DISTRICTID
                end) AGENCYID,  
                                  
                (case when 
                      a.DISTRICTID=f.DISTRICTID  and a.divtype='0' then '1'
                    when
                      a.DISTRICTID=f.DISTRICTID  and (a.divtype = '3' or a.divtype = '4') then '2'
                    when 
                      a.DISTRICTID<>f.DISTRICTID then '3'
                end) DEALTYPE, 
                                               
               p.ISINDEX,
               f.DISTRICTID,
               i.EXPFUNCID,
               f.SPFID,
               f.DEPTID,
               pt.PROJTYPE,
               i.STATUS,
               i.DBVERSION,
               i.datakey
                        
          from p#Spf_t_Pinvestplan i,
               spf_t_pbaseinfo   p,
               spf_t_fbaseinfo   f,
               SPF_T_PROJECTTYPE pt,
               code_t_agency_spf a
         where i.ISPLANVALID = '1'
           and i.PROJECTID = p.PROJECTID
           and p.SPFID = f.SPFID
           and f.PROJTYPEID = pt.PROJTYPEID
           and p.ISINDEX='1'
           and p.AGENCYID=a.GUID )

}';

FOR C_PAR IN (SELECT DISTRICTID,YEAR FROM PUB_T_PARTITION_DIVID WHERE YEAR <> '*') LOOP
    SELECT GLOBAL_MULTYEAR_CZ.SECU_F_GLOBAL_SETPARM('',C_PAR.DISTRICTID,C_PAR.YEAR,'') INTO V_RET FROM DUAL;
    --(2)DICT_T_MODEL
    delete from  DICT_T_MODEL where tableid='2FF5E9BED4EA881DE050A8C021056F31';
    insert into DICT_T_MODEL (APPID, BGTLVL, DBTABLENAME, NAME, DEALTYPE, EXTPROP, INPUTLVL, ISADD, ISMAN, ISPARTITION, ISRESERVED, ISSHOW, ISTASK, ISSUMTAB, MAINUPTAB, ORDERID, RELATAB, REMARK, SECUSQL, INITSQL, INITSQLTIME, SHORTTITLE, STATUS, SUITID, TABLEID, TABLETYPE, TABSWHERE, ISBAK)
    values ('SPF', null, 'SPF_T_PINVESTPLAN_TP', '项目资金计划表(万元)(记账转置)', null, '0000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000', '1', null, null, '1', '0', '1', '0', '0', null, 1, null, null, null, null, '1', null, '1', 'B29F2474AA8F40938D299880CFB87BEF', '2FF5E9BED4EA881DE050A8C021056F31', '2', null, '0');

    --(3)DICT_T_FACTOR
    delete from DICT_T_FACTOR where tableid='2FF5E9BED4EA881DE050A8C021056F31';
    insert into DICT_T_FACTOR (ALIAS, BANDCOLUMNID, BANDREFDWCOL, BGTLVL, COLFORMAT, COLTIPS, COLUMNID, CSID, DATALENGTH, DATATYPE, DBCOLUMNNAME, DEFAULTVALUE, DEID, EXTPROP, FRMCOLID, FRMTABID, HREFLOC, HREFPARMID, ISBANDCOL, ISHREF, OPENWINDOWTYPE, ISKEY, ISLEAF, ISREGEX, ISRESERVE, ISSUM, ISUPDATE, ISVIRTUAL, ISVISIBLE, LEVELNO, NAME, NULLABLE, ORDERID, REGEXPR, REGEXPRINFO, SCALE, SHOWFORMAT, SHOWWIDTH, STATUS, SUPERID, TABLEID, VIRCONTEXT, PARENTNODECANCHECK, XLSXCOLUMNID)
    values ('项目ID', null, null, null, null, null, '2FF5E9BED4EB881DE050A8C021056F31', null, 32, 3, 'PROJECTID', null, null, '0000000000000000000000000000000', null, null, null, null, '0', '0', '0', '0', '1', '0', '0', '0', '0', '0', '1', 1, '项目ID', '1', null, null, null, 0, '0', null, '1', '0', '2FF5E9BED4EA881DE050A8C021056F31', null, '0', null);

    insert into DICT_T_FACTOR (ALIAS, BANDCOLUMNID, BANDREFDWCOL, BGTLVL, COLFORMAT, COLTIPS, COLUMNID, CSID, DATALENGTH, DATATYPE, DBCOLUMNNAME, DEFAULTVALUE, DEID, EXTPROP, FRMCOLID, FRMTABID, HREFLOC, HREFPARMID, ISBANDCOL, ISHREF, OPENWINDOWTYPE, ISKEY, ISLEAF, ISREGEX, ISRESERVE, ISSUM, ISUPDATE, ISVIRTUAL, ISVISIBLE, LEVELNO, NAME, NULLABLE, ORDERID, REGEXPR, REGEXPRINFO, SCALE, SHOWFORMAT, SHOWWIDTH, STATUS, SUPERID, TABLEID, VIRCONTEXT, PARENTNODECANCHECK, XLSXCOLUMNID)
    values ('经济科目', null, null, null, null, null, '2FF5E9BED4EC881DE050A8C021056F31', null, 32, 3, 'EXPECOID', null, null, '0000000000000000000000000000000', null, null, null, null, '0', '0', '0', '0', '1', '0', '0', '0', '0', '0', '1', 1, '经济科目', '1', null, null, null, 0, '0', null, '1', '0', '2FF5E9BED4EA881DE050A8C021056F31', null, '0', null);

    insert into DICT_T_FACTOR (ALIAS, BANDCOLUMNID, BANDREFDWCOL, BGTLVL, COLFORMAT, COLTIPS, COLUMNID, CSID, DATALENGTH, DATATYPE, DBCOLUMNNAME, DEFAULTVALUE, DEID, EXTPROP, FRMCOLID, FRMTABID, HREFLOC, HREFPARMID, ISBANDCOL, ISHREF, OPENWINDOWTYPE, ISKEY, ISLEAF, ISREGEX, ISRESERVE, ISSUM, ISUPDATE, ISVIRTUAL, ISVISIBLE, LEVELNO, NAME, NULLABLE, ORDERID, REGEXPR, REGEXPRINFO, SCALE, SHOWFORMAT, SHOWWIDTH, STATUS, SUPERID, TABLEID, VIRCONTEXT, PARENTNODECANCHECK, XLSXCOLUMNID)
    values ('年份', null, null, null, null, null, '2FF5E9BED4ED881DE050A8C021056F31', null, 32, 3, 'FINYEAR', null, null, '0000000000000000000000000000000', null, null, null, null, '0', '0', '0', '0', '1', '0', '0', '0', '0', '0', '1', 1, '年份', '1', null, null, null, 0, '0', null, '1', '0', '2FF5E9BED4EA881DE050A8C021056F31', null, '0', null);

    insert into DICT_T_FACTOR (ALIAS, BANDCOLUMNID, BANDREFDWCOL, BGTLVL, COLFORMAT, COLTIPS, COLUMNID, CSID, DATALENGTH, DATATYPE, DBCOLUMNNAME, DEFAULTVALUE, DEID, EXTPROP, FRMCOLID, FRMTABID, HREFLOC, HREFPARMID, ISBANDCOL, ISHREF, OPENWINDOWTYPE, ISKEY, ISLEAF, ISREGEX, ISRESERVE, ISSUM, ISUPDATE, ISVIRTUAL, ISVISIBLE, LEVELNO, NAME, NULLABLE, ORDERID, REGEXPR, REGEXPRINFO, SCALE, SHOWFORMAT, SHOWWIDTH, STATUS, SUPERID, TABLEID, VIRCONTEXT, PARENTNODECANCHECK, XLSXCOLUMNID)
    values ('处理类型', null, null, null, null, null, '2FF5E9BED4EE881DE050A8C021056F31', null, 32, 3, 'DEALTYPE', null, null, '0000000000000000000000000000000', null, null, null, null, '0', '0', '0', '0', '1', '0', '0', '0', '0', '0', '1', 1, '处理类型', '1', null, null, null, 0, '0', null, '1', '0', '2FF5E9BED4EA881DE050A8C021056F31', null, '0', null);

    insert into DICT_T_FACTOR (ALIAS, BANDCOLUMNID, BANDREFDWCOL, BGTLVL, COLFORMAT, COLTIPS, COLUMNID, CSID, DATALENGTH, DATATYPE, DBCOLUMNNAME, DEFAULTVALUE, DEID, EXTPROP, FRMCOLID, FRMTABID, HREFLOC, HREFPARMID, ISBANDCOL, ISHREF, OPENWINDOWTYPE, ISKEY, ISLEAF, ISREGEX, ISRESERVE, ISSUM, ISUPDATE, ISVIRTUAL, ISVISIBLE, LEVELNO, NAME, NULLABLE, ORDERID, REGEXPR, REGEXPRINFO, SCALE, SHOWFORMAT, SHOWWIDTH, STATUS, SUPERID, TABLEID, VIRCONTEXT, PARENTNODECANCHECK, XLSXCOLUMNID)
    values ('项目名称', null, null, null, null, null, '2FF5E9BED4EF881DE050A8C021056F31', null, 32, 3, 'PROJNAME', null, null, '0000000000000000000000000000000', null, null, null, null, '0', '0', '0', '0', '1', '0', '0', '0', '0', '0', '1', 1, '项目名称', '1', null, null, null, 0, '0', null, '1', '0', '2FF5E9BED4EA881DE050A8C021056F31', null, '0', null);

    insert into DICT_T_FACTOR (ALIAS, BANDCOLUMNID, BANDREFDWCOL, BGTLVL, COLFORMAT, COLTIPS, COLUMNID, CSID, DATALENGTH, DATATYPE, DBCOLUMNNAME, DEFAULTVALUE, DEID, EXTPROP, FRMCOLID, FRMTABID, HREFLOC, HREFPARMID, ISBANDCOL, ISHREF, OPENWINDOWTYPE, ISKEY, ISLEAF, ISREGEX, ISRESERVE, ISSUM, ISUPDATE, ISVIRTUAL, ISVISIBLE, LEVELNO, NAME, NULLABLE, ORDERID, REGEXPR, REGEXPRINFO, SCALE, SHOWFORMAT, SHOWWIDTH, STATUS, SUPERID, TABLEID, VIRCONTEXT, PARENTNODECANCHECK, XLSXCOLUMNID)
    values ('项目编码', null, null, null, null, null, '2FF5E9BED4F0881DE050A8C021056F31', null, 32, 3, 'PROJCODE', null, null, '0000000000000000000000000000000', null, null, null, null, '0', '0', '0', '0', '1', '0', '0', '0', '0', '0', '1', 1, '项目编码', '1', null, null, null, 0, '0', null, '1', '0', '2FF5E9BED4EA881DE050A8C021056F31', null, '0', null);

    insert into DICT_T_FACTOR (ALIAS, BANDCOLUMNID, BANDREFDWCOL, BGTLVL, COLFORMAT, COLTIPS, COLUMNID, CSID, DATALENGTH, DATATYPE, DBCOLUMNNAME, DEFAULTVALUE, DEID, EXTPROP, FRMCOLID, FRMTABID, HREFLOC, HREFPARMID, ISBANDCOL, ISHREF, OPENWINDOWTYPE, ISKEY, ISLEAF, ISREGEX, ISRESERVE, ISSUM, ISUPDATE, ISVIRTUAL, ISVISIBLE, LEVELNO, NAME, NULLABLE, ORDERID, REGEXPR, REGEXPRINFO, SCALE, SHOWFORMAT, SHOWWIDTH, STATUS, SUPERID, TABLEID, VIRCONTEXT, PARENTNODECANCHECK, XLSXCOLUMNID)
    values ('单位ID', null, null, null, null, null, '2FF5E9BED4F1881DE050A8C021056F31', null, 32, 3, 'AGENCYID', null, null, '0000000000000000000000000000000', null, null, null, null, '0', '0', '0', '0', '1', '0', '0', '0', '0', '0', '1', 1, '单位ID', '1', null, null, null, 0, '0', null, '1', '0', '2FF5E9BED4EA881DE050A8C021056F31', null, '0', null);

    insert into DICT_T_FACTOR (ALIAS, BANDCOLUMNID, BANDREFDWCOL, BGTLVL, COLFORMAT, COLTIPS, COLUMNID, CSID, DATALENGTH, DATATYPE, DBCOLUMNNAME, DEFAULTVALUE, DEID, EXTPROP, FRMCOLID, FRMTABID, HREFLOC, HREFPARMID, ISBANDCOL, ISHREF, OPENWINDOWTYPE, ISKEY, ISLEAF, ISREGEX, ISRESERVE, ISSUM, ISUPDATE, ISVIRTUAL, ISVISIBLE, LEVELNO, NAME, NULLABLE, ORDERID, REGEXPR, REGEXPRINFO, SCALE, SHOWFORMAT, SHOWWIDTH, STATUS, SUPERID, TABLEID, VIRCONTEXT, PARENTNODECANCHECK, XLSXCOLUMNID)
    values ('SPFID', null, null, null, null, null, '2FF5E9BED4F2881DE050A8C021056F31', null, 32, 3, 'SPFID', null, null, '0000000000000000000000000000000', null, null, null, null, '0', '0', '0', '0', '1', '0', '0', '0', '0', '0', '1', 1, 'SPFID', '1', null, null, null, 0, '0', null, '1', '0', '2FF5E9BED4EA881DE050A8C021056F31', null, '0', null);

    insert into DICT_T_FACTOR (ALIAS, BANDCOLUMNID, BANDREFDWCOL, BGTLVL, COLFORMAT, COLTIPS, COLUMNID, CSID, DATALENGTH, DATATYPE, DBCOLUMNNAME, DEFAULTVALUE, DEID, EXTPROP, FRMCOLID, FRMTABID, HREFLOC, HREFPARMID, ISBANDCOL, ISHREF, OPENWINDOWTYPE, ISKEY, ISLEAF, ISREGEX, ISRESERVE, ISSUM, ISUPDATE, ISVIRTUAL, ISVISIBLE, LEVELNO, NAME, NULLABLE, ORDERID, REGEXPR, REGEXPRINFO, SCALE, SHOWFORMAT, SHOWWIDTH, STATUS, SUPERID, TABLEID, VIRCONTEXT, PARENTNODECANCHECK, XLSXCOLUMNID)
    values ('部门ID', null, null, null, null, null, '2FF5E9BED4F3881DE050A8C021056F31', null, 32, 3, 'DEPTID', null, null, '0000000000000000000000000000000', null, null, null, null, '0', '0', '0', '0', '1', '0', '0', '0', '0', '0', '1', 1, '部门ID', '1', null, null, null, 0, '0', null, '1', '0', '2FF5E9BED4EA881DE050A8C021056F31', null, '0', null);

    insert into DICT_T_FACTOR (ALIAS, BANDCOLUMNID, BANDREFDWCOL, BGTLVL, COLFORMAT, COLTIPS, COLUMNID, CSID, DATALENGTH, DATATYPE, DBCOLUMNNAME, DEFAULTVALUE, DEID, EXTPROP, FRMCOLID, FRMTABID, HREFLOC, HREFPARMID, ISBANDCOL, ISHREF, OPENWINDOWTYPE, ISKEY, ISLEAF, ISREGEX, ISRESERVE, ISSUM, ISUPDATE, ISVIRTUAL, ISVISIBLE, LEVELNO, NAME, NULLABLE, ORDERID, REGEXPR, REGEXPRINFO, SCALE, SHOWFORMAT, SHOWWIDTH, STATUS, SUPERID, TABLEID, VIRCONTEXT, PARENTNODECANCHECK, XLSXCOLUMNID)
    values ('项目类别', null, null, null, null, null, '2FF5E9BED4F4881DE050A8C021056F31', null, 32, 3, 'PROJTYPE', null, null, '0000000000000000000000000000000', null, null, null, null, '0', '0', '0', '0', '1', '0', '0', '0', '0', '0', '1', 1, '项目类别', '1', null, null, null, 0, '0', null, '1', '0', '2FF5E9BED4EA881DE050A8C021056F31', null, '0', null);

    insert into DICT_T_FACTOR (ALIAS, BANDCOLUMNID, BANDREFDWCOL, BGTLVL, COLFORMAT, COLTIPS, COLUMNID, CSID, DATALENGTH, DATATYPE, DBCOLUMNNAME, DEFAULTVALUE, DEID, EXTPROP, FRMCOLID, FRMTABID, HREFLOC, HREFPARMID, ISBANDCOL, ISHREF, OPENWINDOWTYPE, ISKEY, ISLEAF, ISREGEX, ISRESERVE, ISSUM, ISUPDATE, ISVIRTUAL, ISVISIBLE, LEVELNO, NAME, NULLABLE, ORDERID, REGEXPR, REGEXPRINFO, SCALE, SHOWFORMAT, SHOWWIDTH, STATUS, SUPERID, TABLEID, VIRCONTEXT, PARENTNODECANCHECK, XLSXCOLUMNID)
    values ('金额', null, null, null, null, null, '2FF5E9BED4F5881DE050A8C021056F31', null, 24, 2, 'AMOUNT', null, null, '0000000000000000000000000000000', null, null, null, null, '0', '0', '0', '0', '1', '0', '0', '0', '0', '0', '1', 1, '金额', '1', null, null, null, 6, '0', null, '1', '0', '2FF5E9BED4EA881DE050A8C021056F31', null, '0', null);

    insert into DICT_T_FACTOR (ALIAS, BANDCOLUMNID, BANDREFDWCOL, BGTLVL, COLFORMAT, COLTIPS, COLUMNID, CSID, DATALENGTH, DATATYPE, DBCOLUMNNAME, DEFAULTVALUE, DEID, EXTPROP, FRMCOLID, FRMTABID, HREFLOC, HREFPARMID, ISBANDCOL, ISHREF, OPENWINDOWTYPE, ISKEY, ISLEAF, ISREGEX, ISRESERVE, ISSUM, ISUPDATE, ISVIRTUAL, ISVISIBLE, LEVELNO, NAME, NULLABLE, ORDERID, REGEXPR, REGEXPRINFO, SCALE, SHOWFORMAT, SHOWWIDTH, STATUS, SUPERID, TABLEID, VIRCONTEXT, PARENTNODECANCHECK, XLSXCOLUMNID)
    values ('数据类型', null, null, null, null, null, '2FF5E9BED4F6881DE050A8C021056F31', null, 32, 3, 'DATATYPE', null, null, '0000000000000000000000000000000', null, null, null, null, '0', '0', '0', '0', '1', '0', '0', '0', '0', '0', '1', 1, '数据类型', '1', null, null, null, 0, '0', null, '1', '0', '2FF5E9BED4EA881DE050A8C021056F31', null, '0', null);

    insert into DICT_T_FACTOR (ALIAS, BANDCOLUMNID, BANDREFDWCOL, BGTLVL, COLFORMAT, COLTIPS, COLUMNID, CSID, DATALENGTH, DATATYPE, DBCOLUMNNAME, DEFAULTVALUE, DEID, EXTPROP, FRMCOLID, FRMTABID, HREFLOC, HREFPARMID, ISBANDCOL, ISHREF, OPENWINDOWTYPE, ISKEY, ISLEAF, ISREGEX, ISRESERVE, ISSUM, ISUPDATE, ISVIRTUAL, ISVISIBLE, LEVELNO, NAME, NULLABLE, ORDERID, REGEXPR, REGEXPRINFO, SCALE, SHOWFORMAT, SHOWWIDTH, STATUS, SUPERID, TABLEID, VIRCONTEXT, PARENTNODECANCHECK, XLSXCOLUMNID)
    values ('功能科目', null, null, null, null, null, '2FF605D920A0A434E050A8C021056FD5', null, 32, 3, 'EXPFUNCID', null, null, '0000000000000000000000000000000', null, null, null, null, '0', '0', '0', '0', '1', '0', '0', '0', '0', '0', '1', 1, '功能科目', '1', null, null, null, 0, '0', null, '1', '0', '2FF5E9BED4EA881DE050A8C021056F31', null, '0', null);

    insert into DICT_T_FACTOR (ALIAS, BANDCOLUMNID, BANDREFDWCOL, BGTLVL, COLFORMAT, COLTIPS, COLUMNID, CSID, DATALENGTH, DATATYPE, DBCOLUMNNAME, DEFAULTVALUE, DEID, EXTPROP, FRMCOLID, FRMTABID, HREFLOC, HREFPARMID, ISBANDCOL, ISHREF, OPENWINDOWTYPE, ISKEY, ISLEAF, ISREGEX, ISRESERVE, ISSUM, ISUPDATE, ISVIRTUAL, ISVISIBLE, LEVELNO, NAME, NULLABLE, ORDERID, REGEXPR, REGEXPRINFO, SCALE, SHOWFORMAT, SHOWWIDTH, STATUS, SUPERID, TABLEID, VIRCONTEXT, PARENTNODECANCHECK, XLSXCOLUMNID)
    values ('区划ID', null, null, null, null, null, '2FF63BD8A2B445BEE050A8C021057053', null, 32, 3, 'DISTRICTID', null, null, '0000000000000000000000000000000', null, null, null, null, '0', '0', '0', '0', '1', '0', '0', '0', '0', '0', '1', 1, '区划ID', '1', null, null, null, 0, '0', null, '1', '0', '2FF5E9BED4EA881DE050A8C021056F31', null, '0', null);

    insert into DICT_T_FACTOR (ALIAS, BANDCOLUMNID, BANDREFDWCOL, BGTLVL, COLFORMAT, COLTIPS, COLUMNID, CSID, DATALENGTH, DATATYPE, DBCOLUMNNAME, DEFAULTVALUE, DEID, EXTPROP, FRMCOLID, FRMTABID, HREFLOC, HREFPARMID, ISBANDCOL, ISHREF, OPENWINDOWTYPE, ISKEY, ISLEAF, ISREGEX, ISRESERVE, ISSUM, ISUPDATE, ISVIRTUAL, ISVISIBLE, LEVELNO, NAME, NULLABLE, ORDERID, REGEXPR, REGEXPRINFO, SCALE, SHOWFORMAT, SHOWWIDTH, STATUS, SUPERID, TABLEID, VIRCONTEXT, PARENTNODECANCHECK, XLSXCOLUMNID)
    values ('DATAKEY', null, null, null, null, null, '30BA41D5DF00326DE050A8C021053A9D', null, 32, 3, 'DATAKEY', null, null, '0000000000000000000000000000000', null, null, null, null, '0', '0', '0', '0', '1', '0', '0', '0', '0', '0', '1', 1, 'DATAKEY', '1', null, null, null, 0, '0', null, '1', '0', '2FF5E9BED4EA881DE050A8C021056F31', null, '0', null);


    --4、生成记账配置相关信息

    --(1)增加DICT_T_BILLDEFTYPE 表纳入指标配置信息
    delete FROM DICT_T_BILLDEFTYPE a where defid='2D6C4F72FDFB8D7CE050A8C021052068';  --删除之前插入的数据
    delete FROM DICT_T_BILLDEFTYPE a where defid='2FF12BD6BE091B51E050A8C0210562D8';
    insert into DICT_T_BILLDEFTYPE (BILLTYPE, BILLTYPENAME,  DEFID, GUID, ORDERID, APPID, REMARK, BUSIKEY, STATUS)
    values ('4', '纳入指标', '2FF12BD6BE091B51E050A8C0210562D8', '2C964C3286235012E050A8C0210536C8', 4, 'SPF', null, 'DATAKEY', '1');


    --(2)增加存储过程配置信息
    delete from dict_t_billproc a where a.APPID='SPF' and procid='P_SPF_TRANSPOSE_ININDEX';
    insert into dict_t_billproc (APPID, PROCID, PROCNAME, STATUS)
    values ('SPF', 'P_SPF_TRANSPOSE_ININDEX', '生成纳入指标来源表', '1');


    --(3)增加dict_t_billdef表信息
    delete from dict_t_billdef where appid ='SPF' AND GUID='2D6C4F72FDFB8D7CE050A8C021052068';  --删除之前插入的数据
    delete from dict_t_billdef where appid ='SPF' AND GUID='2FF12BD6BE091B51E050A8C0210562D8';
    insert into dict_t_billdef (APPID, APPROVEDCOLS, BILLCOL, BILLDEFNAME, CHECKSQL,  GENSRCTABID, GUID, OFFSETCOL, SUMCOL, PROCNAME, SRCDBTABID, SRCTABID, SRCWHERE, WHEREDESC, STATUS, TGTTABID, ISINCR, INCLUDEDEL)
    values ('SPF', '{"name":"DATAKEY,项目唯一标识,财年,功能科目,经济科目,省部门预算管理处核定金额,省财政核定金额,追加指标金额","id":"1684820C202BFDA8E050A8C0210542E8,14C0C3214F28189EE050A8C0210507CA,14C0C3214F29189EE050A8C0210507CA,170704CA9CDB7503E050A8C021057EFA,170704CA9CDA7503E050A8C021057EFA,A1C6CA1911EE4D58ACB1581E66668D90,14C0C3214F2B189EE050A8C0210507CA,14C0C3214F37189EE050A8C0210507CA"}', '160C5F487EEE01BDE050A8C0210576F1', '纳入指标', null, '2FF5E9BED4EA881DE050A8C021056F31', '2FF12BD6BE091B51E050A8C0210562D8', '1552C6AC3D230614E050A8C02105555B', '158FDE1494C9715AE050A8C021052929', 'P_SPF_TRANSPOSE_ININDEX', null, '14C0C3214F27189EE050A8C0210507CA', ' ''$PROJECTID$'' like ''%''||projectid||''%''', ' ''$项目ID$'' like ''%''||projectid||''%''', '1', '1552C6AC3D230614E050A8C0210556AB', '1', '1');



    --(4)增加 dict_t_billbasic表信息
    delete from dict_t_billbasic a where a.BILLDEFID='2FF12BD6BE091B51E050A8C0210562D8'; 
    insert into dict_t_billbasic (BILLDEFID, COLUMNID, GUID, STATUS)
    values ('2FF12BD6BE091B51E050A8C0210562D8', '1684820C202BFDA8E050A8C0210542E8', '2FF387062F9ECE91E050A8C021056900', '1');

    insert into dict_t_billbasic (BILLDEFID, COLUMNID,GUID, STATUS)
    values ('2FF12BD6BE091B51E050A8C0210562D8', '14C0C3214F28189EE050A8C0210507CA', '2FF387062F9FCE91E050A8C021056900', '1');

    insert into dict_t_billbasic (BILLDEFID, COLUMNID,GUID, STATUS)
    values ('2FF12BD6BE091B51E050A8C0210562D8', '14C0C3214F29189EE050A8C0210507CA', '2FF387062FA0CE91E050A8C021056900', '1');

    insert into dict_t_billbasic (BILLDEFID, COLUMNID,GUID, STATUS)
    values ('2FF12BD6BE091B51E050A8C0210562D8', '170704CA9CDB7503E050A8C021057EFA', '2FF387062FA1CE91E050A8C021056900', '1');

    insert into dict_t_billbasic (BILLDEFID, COLUMNID,GUID, STATUS)
    values ('2FF12BD6BE091B51E050A8C0210562D8', '170704CA9CDA7503E050A8C021057EFA', '2FF387062FA2CE91E050A8C021056900', '1');

    insert into dict_t_billbasic (BILLDEFID, COLUMNID,GUID, STATUS)
    values ('2FF12BD6BE091B51E050A8C0210562D8', 'A1C6CA1911EE4D58ACB1581E66668D90', '2FF387062FA3CE91E050A8C021056900', '1');

    insert into dict_t_billbasic (BILLDEFID, COLUMNID,GUID, STATUS)
    values ('2FF12BD6BE091B51E050A8C0210562D8', '14C0C3214F2B189EE050A8C0210507CA', '2FF387062FA4CE91E050A8C021056900', '1');

    insert into dict_t_billbasic (BILLDEFID, COLUMNID,GUID, STATUS)
    values ('2FF12BD6BE091B51E050A8C0210562D8', '14C0C3214F37189EE050A8C0210507CA', '2FF387062FA5CE91E050A8C021056900', '1');


    --(5)增加dict_t_tgtrelation 表信息
    delete from dict_t_tgtrelation a where a.billdefiD='2FF12BD6BE091B51E050A8C0210562D8';

    insert into dict_t_tgtrelation (BILLDEFID,GUID, ISDELETE, ISUPDATE, SRCSQL, SRCSQLDESC, STATUS, TGTCOLID)
    values ('2FF12BD6BE091B51E050A8C0210562D8', '3032AEE0AEA464C5E050A8C0210571CE', '0', '0', '『2FF5E9BED4ED881DE050A8C021056F31』', '『年份』', '1', '1552C6AC3D270614E050A8C0210556AB');

    insert into dict_t_tgtrelation (BILLDEFID,GUID, ISDELETE, ISUPDATE, SRCSQL, SRCSQLDESC, STATUS, TGTCOLID)
    values ('2FF12BD6BE091B51E050A8C0210562D8', '3032AEE0AEA564C5E050A8C0210571CE', '0', '0', '『2FF5E9BED4EE881DE050A8C021056F31』', '『处理类型』', '1', '158FF450FBA2EF2AE050A8C021052A72');

    insert into dict_t_tgtrelation (BILLDEFID,GUID, ISDELETE, ISUPDATE, SRCSQL, SRCSQLDESC, STATUS, TGTCOLID)
    values ('2FF12BD6BE091B51E050A8C0210562D8', '3032AEE0AEA664C5E050A8C0210571CE', '0', '0', '『2FF5E9BED4F0881DE050A8C021056F31』', '『项目编码』', '1', '158FF450FBA0EF2AE050A8C021052A72');

    insert into dict_t_tgtrelation (BILLDEFID,GUID, ISDELETE, ISUPDATE, SRCSQL, SRCSQLDESC, STATUS, TGTCOLID)
    values ('2FF12BD6BE091B51E050A8C0210562D8', '3032AEE0AEA764C5E050A8C0210571CE', '0', '0', '『2FF605D920A0A434E050A8C021056FD5』', '『功能科目』', '1', '1552C8BC6D0265B3E050A8C02105560F');

    insert into dict_t_tgtrelation (BILLDEFID,GUID, ISDELETE, ISUPDATE, SRCSQL, SRCSQLDESC, STATUS, TGTCOLID)
    values ('2FF12BD6BE091B51E050A8C0210562D8', '3032AEE0AEA864C5E050A8C0210571CE', '0', '0', '『2FF5E9BED4EC881DE050A8C021056F31』', '『经济科目』', '1', '17078745A91EA7C8E050A8C021050255');

    insert into dict_t_tgtrelation (BILLDEFID,GUID, ISDELETE, ISUPDATE, SRCSQL, SRCSQLDESC, STATUS, TGTCOLID)
    values ('2FF12BD6BE091B51E050A8C0210562D8', '3032AEE0AEA964C5E050A8C0210571CE', '0', '0', '『2FF5E9BED4EF881DE050A8C021056F31』', '『项目名称』', '1', '15905E0C93F61F8AE050A8C021052CC0');

    insert into dict_t_tgtrelation (BILLDEFID,GUID, ISDELETE, ISUPDATE, SRCSQL, SRCSQLDESC, STATUS, TGTCOLID)
    values ('2FF12BD6BE091B51E050A8C0210562D8', '3032AEE0AEAA64C5E050A8C0210571CE', '0', '0', '『2FF5E9BED4F4881DE050A8C021056F31』', '『项目类别』', '1', '15EE9F4E4B49EA80E050A8C021051508');

    insert into dict_t_tgtrelation (BILLDEFID,GUID, ISDELETE, ISUPDATE, SRCSQL, SRCSQLDESC, STATUS, TGTCOLID)
    values ('2FF12BD6BE091B51E050A8C0210562D8', '3032AEE0AEAB64C5E050A8C0210571CE', '0', '0', '『2FF5E9BED4F5881DE050A8C021056F31』', '『金额』', '1', '158FDE1494C9715AE050A8C021052929');

    insert into dict_t_tgtrelation (BILLDEFID,GUID, ISDELETE, ISUPDATE, SRCSQL, SRCSQLDESC, STATUS, TGTCOLID)
    values ('2FF12BD6BE091B51E050A8C0210562D8', '3032AEE0AEAC64C5E050A8C0210571CE', '0', '0', '『2FF5E9BED4F1881DE050A8C021056F31』', '『单位ID』', '1', '1552C6AC3D280614E050A8C0210556AB');

    insert into dict_t_tgtrelation (BILLDEFID,GUID, ISDELETE, ISUPDATE, SRCSQL, SRCSQLDESC, STATUS, TGTCOLID)
    values ('2FF12BD6BE091B51E050A8C0210562D8', '3032AEE0AEAD64C5E050A8C0210571CE', '0', '0', '『2FF5E9BED4EB881DE050A8C021056F31』', '『项目ID』', '1', '158FF450FBA4EF2AE050A8C021052A72');

    insert into dict_t_tgtrelation (BILLDEFID,GUID, ISDELETE, ISUPDATE, SRCSQL, SRCSQLDESC, STATUS, TGTCOLID)
    values ('2FF12BD6BE091B51E050A8C0210562D8', '3032AEE0AEAE64C5E050A8C0210571CE', null, null, '『2FF5E9BED4F3881DE050A8C021056F31』', '『部门ID』', '1', '1552C8BC6D0165B3E050A8C02105560F');

    insert into dict_t_tgtrelation (BILLDEFID,GUID, ISDELETE, ISUPDATE, SRCSQL, SRCSQLDESC, STATUS, TGTCOLID)
    values ('2FF12BD6BE091B51E050A8C0210562D8', '3032AEE0AEAF64C5E050A8C0210571CE', '0', '0', '『2FF5E9BED4F2881DE050A8C021056F31』', '『SPFID』', '1', '158FF450FBA3EF2AE050A8C021052A72');

    insert into dict_t_tgtrelation (BILLDEFID,GUID, ISDELETE, ISUPDATE, SRCSQL, SRCSQLDESC, STATUS, TGTCOLID)
    values ('2FF12BD6BE091B51E050A8C0210562D8', '30BA41D5DF01326DE050A8C021053A9D', '1', '1', '『30BA41D5DF00326DE050A8C021053A9D』', '『DATAKEY』', '1', '1552C6AC3D240614E050A8C0210556AB');
END LOOP;
end;
--纳入指标记账脚本
